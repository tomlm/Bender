<Styles xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:dv="using:DumpViewer"
        xmlns:ae="using:AvaloniaEdit">

    <Design.PreviewWith>
        <Border Padding="20" Background="#1E1E1E">
            <dv:ObjectViewer Value="Test String" />
        </Border>
    </Design.PreviewWith>

    <!-- Default layout resources (can be overridden in App.axaml) -->
    <Styles.Resources>
        <Thickness x:Key="ObjectViewerPadding">8</Thickness>
        <x:Double x:Key="ObjectViewerFontSize">13</x:Double>
        <Thickness x:Key="ObjectViewerItemSpacing">0,0,4,0</Thickness>
        <x:Double x:Key="ObjectViewerRawPaneWidth">400</x:Double>
    </Styles.Resources>

    <!-- ObjectViewer template using TreeView -->
    <Style Selector="dv|ObjectViewer">
        <Setter Property="Template">
            <ControlTemplate>
                <Border Padding="{DynamicResource ObjectViewerPadding}" Background="#1E1E1E">
                    <DockPanel>
                        <!-- Search Panel -->
                        <Grid DockPanel.Dock="Top" ColumnDefinitions="*,Auto" Margin="0,0,0,8">
                            <TextBox Name="PART_SearchTextBox"
                                     Grid.Column="0"
                                     Watermark="Search..."
                                     Background="#2D2D2D"
                                     Foreground="#D4D4D4"
                                     BorderBrush="#3F3F46"
                                     Margin="0,0,4,0"/>
                            <Button Name="PART_SearchButton"
                                    Grid.Column="1"
                                    Content="Search"
                                    Background="#0E639C"
                                    Foreground="White"
                                    Padding="12,6"/>
                        </Grid>
                        
                        <!-- Main content with optional raw text pane -->
                        <Grid ColumnDefinitions="*,Auto,400">
                            <!-- Tree View (left side) -->
                            <TreeView Name="PART_TreeView"
                                      Grid.Column="0"
                                      ItemsSource="{Binding Items, RelativeSource={RelativeSource TemplatedParent}}"
                                      Background="Transparent">
                                <TreeView.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <VirtualizingStackPanel />
                                    </ItemsPanelTemplate>
                                </TreeView.ItemsPanel>
                                <TreeView.Styles>
                                    <Style Selector="TreeViewItem" x:DataType="dv:ObjectNode">
                                        <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
                                        <Setter Property="Foreground" Value="#D4D4D4"/>
                                        <Setter Property="FontFamily" Value="Consolas, Monaco, 'Courier New', monospace"/>
                                        <Setter Property="FontSize" Value="{DynamicResource ObjectViewerFontSize}"/>
                                    </Style>
                                </TreeView.Styles>
                                <TreeView.ItemTemplate>
                                    <TreeDataTemplate DataType="dv:ObjectNode" ItemsSource="{Binding Children}">
                                        <StackPanel Orientation="Horizontal">
                                            <!-- Line number indicator -->
                                            <TextBlock Text="{Binding StartLine, StringFormat='L{0}'}"
                                                       IsVisible="{Binding HasSourceLocation}"
                                                       Foreground="#6A9955"
                                                       FontSize="10"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,6,0"
                                                       Opacity="0.7"/>
                                            
                                            <!-- Property name -->
                                            <TextBlock Text="{Binding Name}"
                                                       IsVisible="{Binding Name, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                                       Foreground="#9CDCFE"
                                                       Margin="{DynamicResource ObjectViewerItemSpacing}"/>
                                            
                                            <TextBlock Text=": "
                                                       IsVisible="{Binding Name, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                                       Foreground="#D4D4D4"/>
                                            
                                            <!-- Type name for complex types -->
                                            <TextBlock Text="{Binding TypeName}"
                                                       IsVisible="{Binding HasChildren}"
                                                       Foreground="#4EC9B0"
                                                       Margin="{DynamicResource ObjectViewerItemSpacing}"/>
                                            
                                            <!-- Display value with color based on kind -->
                                            <TextBlock Text="{Binding DisplayValue}"
                                                       Foreground="{Binding Kind, Converter={x:Static dv:NodeKindToBrushConverter.Instance}}"
                                                       FontStyle="{Binding Kind, Converter={x:Static dv:NodeKindToFontStyleConverter.Instance}}"/>
                                        </StackPanel>
                                    </TreeDataTemplate>
                                </TreeView.ItemTemplate>
                            </TreeView>
                            
                            <!-- Splitter -->
                            <GridSplitter Grid.Column="1" 
                                          Width="4" 
                                          Background="#3F3F46"
                                          IsVisible="{Binding SourceText, RelativeSource={RelativeSource TemplatedParent}, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                            
                            <!-- Raw Text Pane (right side) with AvaloniaEdit -->
                            <Border Grid.Column="2" 
                                    MinWidth="200"
                                    Background="#1E1E1E"
                                    BorderBrush="#3F3F46"
                                    BorderThickness="1,0,0,0"
                                    IsVisible="{Binding SourceText, RelativeSource={RelativeSource TemplatedParent}, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                <DockPanel>
                                    <!-- Header -->
                                    <Border DockPanel.Dock="Top" 
                                            Background="#2D2D2D" 
                                            Padding="8,4">
                                        <TextBlock Text="Source" 
                                                   Foreground="#808080" 
                                                   FontSize="11"/>
                                    </Border>
                                    
                                    <!-- AvaloniaEdit TextEditor -->
                                    <ae:TextEditor Name="PART_TextEditor"
                                                   IsReadOnly="True"
                                                   ShowLineNumbers="True"
                                                   FontFamily="Consolas, Monaco, 'Courier New', monospace"
                                                   FontSize="{DynamicResource ObjectViewerFontSize}"
                                                   Background="#1E1E1E"
                                                   Foreground="#D4D4D4"
                                                   LineNumbersForeground="#858585"
                                                   HorizontalScrollBarVisibility="Auto"
                                                   VerticalScrollBarVisibility="Auto"/>
                                </DockPanel>
                            </Border>
                        </Grid>
                    </DockPanel>
                </Border>
            </ControlTemplate>
        </Setter>
    </Style>
    
</Styles>
